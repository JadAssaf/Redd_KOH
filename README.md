# Redd_KOH: Automated KOH Smear Slide Analysis

## Overview
Redd_KOH is a Windows-based automation pipeline for AI-assisted analysis of KOH smear whole slide images (WSI). It integrates with MicroVisioneer mvSlide to trigger inference, collect user input, and log results, including slide quality and human/AI interpretations. The workflow is designed for digital pathology labs and supports backup to OneDrive and Google Drive.

## Directory Structure

```
Redd_KOH/
├── heatmaps/         # Output directory for AI-generated heatmap overlays
├── inference.exe     # Main AI inference executable (called by the script)
├── log/              # Logs, CSV history, and stdout/stderr from inference
├── models/           # Model weights and subfolders (e.g., test/ for test slides)
│   └── test/         # Example/test slides for validation
├── run_inference.bat # Batch file to trigger the PowerShell pipeline
├── run_inference.ps1 # Main PowerShell script for the workflow and UI
├── README.md         # This documentation file
├── README.txt        # (Legacy) Old instructions, see README.md for updates
```

## Main Components

- **run_inference.ps1**: Orchestrates the workflow. Handles:
  - User prompts (name, slide quality, preliminary/final interpretation)
  - Launches `inference.exe` for AI prediction
  - Displays results and heatmaps
  - Logs all actions and results to CSV and log files
  - Backs up results to OneDrive/Google Drive if enabled

- **run_inference.bat**: Simple wrapper to call the PowerShell script with the slide path argument. Used by mvSlide automation.

- **inference.exe**: The AI model inference engine. Takes a slide and model weights, outputs predictions and heatmaps.

- **models/**: Stores model weights (`.pth` files) and test slides. Place your trained models here.

- **heatmaps/**: Output directory for overlay images generated by the AI.

- **log/**: Contains logs, CSV history (`interpretation_history.csv`), and stdout/stderr from inference runs.

## How to Run

1. **Manual Test**
   ```powershell
   powershell -ExecutionPolicy Bypass -File "C:\Users\Public\Redd_KOH\run_inference.ps1" -SlidePath "C:\Users\Public\Redd_KOH\models\test\M0002_KOH_40X_2.svs"
   ```
   - Replace the slide path as needed. Any `.svs`, `.png`, `.jpg`, or `.tif` file is accepted.
   - The script will prompt for user name, slide quality, and interpretations.
   - Results and logs are saved in the `log/` directory and backed up if enabled.

2. **Automated Trigger (from mvSlide)**
   - mvSlide can be configured to call `run_inference.bat` after a scan is saved.
   - The batch file passes the slide path to the PowerShell script automatically.

## Requirements
- Windows 10+
- PowerShell 5+
- .NET Framework (for Windows Forms)
- (Optional) OneDrive/Google Drive for backup
- Model weights in `models/`
- `inference.exe` in the root directory

## Workflow Summary
1. User (or mvSlide) triggers the script with a slide path.
2. User is prompted for name and slide quality (Good/Fair/Poor, with definitions).
3. User provides a preliminary interpretation.
4. AI inference runs (unless disabled for testing).
5. Results and heatmap overlays are shown.
6. User provides a final interpretation.
7. All data is logged to CSV and backed up.

## Updating/Extending
- To update model weights, replace files in `models/`.
- To add new output types, modify `run_inference.ps1`.
- For new backup locations, update the relevant script sections.

## Support
For issues or feature requests, please contact the project maintainer or open an issue in your version control system. 